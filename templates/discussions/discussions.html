{% extends './base.html' %} {% block content %}
<table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Discussion Title</th>
      <th scope="col">Status</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
  <tbody>
    {% if discussions.count == 0 %}
    <tr>
      <td colspan="4" class="text-center">
        No discussions available at the moment. Feel free to start one!
      </td>
    </tr>
    {% else %} {% for discussion in discussions %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>
      <td>{{ discussion.title }}</td>
      <td>{{ discussion.is_live }}</td>
      <td>
        <div class="d-flex justify-content-start gap-2">
          <a
            href="#"
            class="btn btn-sm btn-primary text-decoration-none"
            onclick="joinMeeting('{{ discussion.title }}')"
            >Join</a
          >
          <a href="#" class="btn btn-sm btn-success text-decoration-none"
            >Subscribe</a
          >
        </div>
      </td>
    </tr>
    {% endfor %}<br />
    {% endif %}
  </tbody>
</table>

<div id="jitsi-container" style="height: 500px"></div>

<script>
  function joinMeeting(meetingId) {
    const domain = "meet.jit.si";
    const options = {
      roomName: meetingId,
      width: "100%",
      height: "100%",
      parentNode: document.querySelector("#jitsi-container"),
      configOverwrite: {
        startWithAudioMuted: true,
        startWithVideoMuted: false,
        enableLobbyChat: false,
        prejoinPageEnabled: false,
        hideLobbyButton: true,
        enableWelcomePage: false,
        disableDeepLinking: true,
        disableModeration: true,
        autoAcceptInvites: true,
      },
      interfaceConfigOverwrite: {
        filmStripOnly: false,
        DISABLE_VIDEO_BACKGROUND: true,
        SHOW_JITSI_WATERMARK: false,
      },
    };

    try {
      const api = new JitsiMeetExternalAPI(domain, options);
      api.addEventListener("readyToClose", () => {
        console.log("Jitsi Meet closed");
      });
      api.addEventListener("videoConferenceJoined", () => {
        console.log("Jitsi Meet joined");
      });
      api.addEventListener("videoConferenceLeft", () => {
        console.log("Jitsi Meet left");
      });
      api.addEventListener("participantJoined", (participant) => {
        console.log("Participant joined: ", participant);
      });
      api.addEventListener("participantLeft", (participant) => {
        console.log("Participant left: ", participant);
      });
      api.addEventListener("log", (log) => {
        console.log("Jitsi Meet log: ", log);
      });
    } catch (error) {
      console.error("Error loading Jitsi Meet: ", error);
    }
  }
</script>

{% endblock content %}
